<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Smart Home Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: white; min-height: 100vh; }
        .glass-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; }
        .btn-glow { background: #38bdf8; border: none; font-weight: 600; color: #0f172a; transition: 0.3s; }
        .btn-glow:hover { background: #7dd3fc; box-shadow: 0 0 20px rgba(56, 189, 248, 0.5); }
        .temp-display { font-size: 3rem; font-weight: 700; color: #38bdf8; }
        label { color: #94a3b8; font-size: 0.85rem; }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="fw-bold">Smart Home <span style="color: #38bdf8;">AI</span></h1>
        <p class="text-secondary">Sistem Prediksi Suhu Ruangan Berbasis Real-Time</p>
    </div>

    <div class="row g-4 justify-content-center">
        <div class="col-lg-4">
            <div class="glass-card p-4">
                <h5 class="mb-4">Kontrol Sensor</h5>
                <div class="mb-3">
                    <label>Suhu Luar (°C)</label>
                    <input type="number" id="suhu_luar" class="form-control bg-dark text-white border-secondary" value="32">
                </div>
                <div class="mb-3">
                    <label>Kelembaban (%)</label>
                    <input type="number" id="kelembaban" class="form-control bg-dark text-white border-secondary" value="60">
                </div>
                <div class="mb-3">
                    <label>Jam (0-23)</label>
                    <input type="number" id="jam" class="form-control bg-dark text-white border-secondary" value="14">
                </div>
                <div class="mb-4">
                    <label>Status AC</label>
                    <select id="status_ac" class="form-select bg-dark text-white border-secondary">
                        <option value="0">AC Mati</option>
                        <option value="1">AC Menyala</option>
                    </select>
                </div>
                <button onclick="panggilAI()" class="btn btn-glow w-100 py-3">Prediksi Suhu Ruangan</button>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="glass-card p-4 h-100 d-flex flex-column justify-content-center text-center">
                <h6>Estimasi Suhu Ruangan</h6>
                <div id="displaySuhu" class="temp-display my-3">-- °C</div>
                <div class="mt-4" style="height: 250px;">
                    <canvas id="tempChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('tempChart').getContext('2d');
    let myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Riwayat (°C)',
                data: [],
                borderColor: '#38bdf8',
                tension: 0.4,
                fill: true,
                backgroundColor: 'rgba(56, 189, 248, 0.1)'
            }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
    });

    async function panggilAI() {
        const payload = {
            suhu_luar: document.getElementById('suhu_luar').value,
            kelembaban: document.getElementById('kelembaban').value,
            jam: document.getElementById('jam').value,
            status_ac: document.getElementById('status_ac').value
        };

        try {
            const response = await fetch('http://127.0.0.1:5000/api/predict', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const data = await response.json();
            
            if (data.status === 'success') {
                // Tampilkan Hasil
                document.getElementById('displaySuhu').innerText = data.hasil + " °C";
                
                // Update Grafik
                const now = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                myChart.data.labels.push(now);
                myChart.data.datasets[0].data.push(data.hasil);
                if(myChart.data.labels.length > 7) {
                    myChart.data.labels.shift();
                    myChart.data.datasets[0].data.shift();
                }
                myChart.update();
            }
        } catch (error) {
            alert("⚠️ Server Belum Aktif! Jalankan 'python server.py' di terminal.");
        }
    }
</script>
</body>
</html>